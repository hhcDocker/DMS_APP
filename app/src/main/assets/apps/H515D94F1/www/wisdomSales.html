<!DOCTYPE html>
<html>
    <head>
    	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script type="text/javascript" src="js/html_head.js"></script>
		<script src="js/echarts.common.min.js"></script>
		<link href="css/index.css" rel="stylesheet" type="text/css"/>
		<title>智慧网销</title>
    </head>
    <style type="text/css">
    	.chart {
			height: 400px;
			margin: 0px;
			padding: 0px;
		}
		.bordered td{
			text-align: center;
			font-size: 15px;
			text-indent:2px;
		}
		.bordered th{
			background: #10a6e2;
			color: #fff;
			text-shadow:none;
			font-size: 16px;
			text-indent:2px;
		}
    	.addImg{
			background-image: url(images/add.gif);
			background-repeat: no-repeat;
			background-position: center;
			background-size: 23px 23px;
			height: 25px;
			width: 45px;
    	}
    	
    	.addSeach{
		    color: #fff;
		    border-radius: 15px;
			background-color: #10a6e2;
		    background-image: url(images/seach.png);
			background-repeat: no-repeat;
			background-position: center;
			background-size: 15px 15px;
			height: 25px;
			width: 25px;
			margin-right:10px;
			margin-top:3px;
    	}
    	.cusname{
    		height: 50px;
    		font-size: 20px;
    		font-weight: bold;
    	}
    	.gczs{
    		height: 30px;
    		font-weight: bold;
    	}
    	.tipNum{background: #0072E3;border-radius: 14px;padding: 1px 30px;
    	text-align: center;
    	font-size:22px;color:#fff;}
    	body{font-family:Microsoft YaHei,宋体;}
    	input[type=text],input[type=tel],input[type=number]{border:none;}
    </style>
    <body id="onlinebooking" onselectstart="return true;" ondragstart="return false;" onLoad="">
    <form id="fm" method="post">
	<script type="text/javascript" src="js/detail_head.js?_menu_name=智慧营销&_btn_type=5&_show_tel=1" id="detail_head_js"></script>
	<div style="height: 55px;display: none;" id="blankDiv"></div>
    <input type="hidden" name="tabType" id="tabType" value="" />
    <input type="hidden" name="id" id="id" value="" />
	<!--普通用户登录时显示-->
	<div class="cardexplain" id="_showContentDiv1">
	<div id="tabs1">
		<ul class="round">
		<li class="nob">
			<input name="formhash" id="formhash" value="2be3071a" type="hidden">
			<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr class="">
					<td class="cusname" id="cusname"></td>
					<td></td>
				</tr>
			</table>
		</li>
        <li >
            <table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr class="">
                    <td class="gczs">购车指数&nbsp;&nbsp;<img id="showHelpGc" src="images/qs.png" width="20px" height="20px" /></td>
                    <td>
                    	<div style="color: #04A7E0;font-size: 25px;text-align: left;margin-left: 20px;" id="buycarindex"></div>
                    </td>
                </tr>
            </table>
        </li>
		<li class="nob" style="display: none;">
			<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr class="">
                    <td style="color:darkgrey;">上牌：重庆</td>
                    <!--<td style="color:darkgrey;">回访时间：2018-04-10</td>-->
                </tr>
            </table>
		</li>
		<li class="nob">
			<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr class="biaoge">
					<td colspan="2" style="height: 35px;" id="attentionSpecs"></td>
				</tr>
			</table>
		</li>
		<li class="nob">
			<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr class="">
					<td colspan="2" style="height: 35px;">电话号码：<font id="userPhone" ></font></td>
				</tr>
			</table>
		</li>
		<!--<li>
			<div style="height: 10px;background-color: #F0F0F0;"></div>
		</li>-->
		<li class="nob" id="speechTechnique" style="display: none;">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td style="height: 35px;" width="6%"><hr style="height: 15px;width: 1px;margin-left: 12px;" color="#46A3FF" ></td>
					<td style="font-size: large;font-weight: bold;">话术锦囊</td>
					<td style="margin-left: 0px;">
                        <img src="static/img/arrow3.png" width="14px;" height="13px;" style="float: right;margin-right: 12px;"/>
                    </td>
				</tr>
				<tr>
					<td colspan="3" style="height: 35px;">有购车意向，点击查看话术详情</td>
				</tr>
			</table>
		</li>
		<li>
			<div style="height: 10px;background-color: #F0F0F0;"></div>
		</li>
		<li class="nob">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td style="height: 35px;" width="6%"><hr style="height: 15px;width: 1px;margin-left: 12px;" color="#46A3FF" ></td>
					<td style="font-size: large;font-weight: bold;">关注车型</td>
				</tr>
			</table>
		</li>
		<div style="padding-top:5px;width: 100%;overflow-x: auto;">
							<div id="viewReport" class="chart"></div>
						</div>
		<li>
			<div style="height: 10px;background-color: #F0F0F0;"></div>
		</li>
		<li class="nob">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td style="height: 35px;" width="6%"><hr style="height: 15px;width: 1px;margin-left: 12px;" color="#46A3FF" ></td>
					<td style="font-size: large;font-weight: bold;">预算评估</td>
				</tr>
				<tr height="50px;">
					<td colspan="2" style="text-align: center;"><i class="tipNum" style="height: 30px;width: 70%;" align="center" id="budget">26.88万-47.11万</i></td>
				</tr>
			</table>
		</li>
		<li>
			<div style="height: 10px;background-color: #F0F0F0;"></div>
		</li>
		<li class="nob">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td style="height: 35px;" width="6%"><hr style="height: 15px;width: 1px;margin-left: 12px;" color="#46A3FF" ></td>
					<td style="font-size: large;font-weight: bold;">习惯&nbsp;·&nbsp;偏好</td>
				</tr>
				<tr class="biaoge">
					<td style="font-size: large;" colspan="2"></td>
				</tr>
				<tr height="50px;">
					<td style="font-size: large;" style="height: 35px;" colspan="2">配置偏好</td>
				</tr>
				<tr height="35px;">
					<td colspan="2" style="height: 35px;text-indent: 0px;padding-left: 10px;" id="CONFIGUREPREFER"></td>
				</tr>
			</table>
		</li>
		<li>
			<div style="height: 10px;background-color: #F0F0F0;"></div>
		</li>
		<li class="nob">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td style="height: 35px;" width="6%"><hr style="height: 15px;width: 1px;margin-left: 12px;" color="#46A3FF" ></td>
					<td style="font-size: large;font-weight: bold;">其他信息</td>
				</tr>
				<tr class="biaoge">
					<td colspan="3"></td>
				</tr>
			</table>
		</li>
		<li class="nob">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr class="biaoge" style="height: 35px;">
					<td style="font-size: large;">常住地</td>
					<td style="height: 35px;width: 25%;" id="CUSTOMERCITY"></td>
				</tr>
				<tr style="height: 35px;">
					<td style="font-size: large;" colspan="2">购车用途</td>
				</tr>
				<tr style="height: 35px;">
					<td style="height: 35px;width: 25%;text-indent: 0px;padding-left: 10px;"  colspan="2" id="PURPOSE"></td>
				</tr>
			</table>
		</li>
	</ul>
	</div>
	</div>
</form>
</body>
<script type="text/javascript">
	$(document).ready(function() {
		loadData();
		var wsId = UrlParm.parm("wsId");
		$("#speechTechnique").click(function(){
			ToUrl("speechTechnique.html?wsId="+wsId);
		});
		$("#showHelpGc").click(function(){
			showHelp();
		});
	});
    
    function loadData(){
		var wsId = UrlParm.parm("wsId");
		var ptId = UrlParm.parm("ptId");
		var tabType = UrlParm.parm("tabType");
		var url = httpUrlHead+"PotcusAchieveService/queryWisdomsalesInfo.json?wsId="+wsId+"&ptId="+ptId+"&tabType="+tabType+"&"+httpUrlEnd;
		makeFormCall(url,function(json){
			if(json.wsInfo != null) {
				var map = json.wsInfo;
				$("#cusname").html(map.customerName);
				$("#buycarindex").html(map.BUYCARINDEX);
				if( map.attentionSpecsList.length > 0 ){
					$("#attentionSpecs").html(map.attentionSpecsList[0].specs);
				}
				$("#userPhone").html(map.USERPHONE);
				if(!IsNull(map.USERPHONE)){
					$("#userPhone").click(function(){
						callTel();
					});
				}
				setViewReport(map);
				$("#budget").html(map.BUDGET);
				$("#CONFIGUREPREFER").html(map.CONFIGUREPREFER);
				$("#CUSTOMERCITY").html(map.CUSTOMERCITY);
				$("#PURPOSE").html(map.PURPOSE);
			}
		},"fm",false,true);
	}
    
    function callTel(){
    	var tel = $("#userPhone").html();
    	if(!IsNull(tel)){
    		window.location.href='tel:'+tel;
    	}
    }
    
    function showHelp(){
		var alertMsg = "";
		alertMsg += "<div style='text-align:left;'>"+
		"<div>购车指数：根据已询价用户在汽车之家各应用端（pc、app、M站）浏览、询价行为，结合用户购车阶段、车型关注度和商家关注度，通过指数模型预测购车指数；购车指数越高代表用户的购车成交概率越高、成交时间越短。</div>";
		alertMsg += "</div>";
		MuiAlert(alertMsg);
	}
    
    function showFollowDetail(id,tabType){
    	ToUrl("potcusFollowDetail.html?id="+id+"&tabType="+tabType);
    }
    
    function queryMoreGj(){
    	var id = document.getElementById("id").value;
    	var tabType = document.getElementById("tabType").value;
    	var mobilePhone = document.getElementById("contactorMobile").value;
		_toPage("moreGjDetail.html?id="+id+"&tabType="+tabType+"&mobilePhone="+mobilePhone);
    }
    function setViewReport(json){
    	json.reportId = "viewReport";
    	json.reportType = "bar";
		json.reportTitle = ['关注度', '已询价次数'];
	 var titleArray = json.reportTitle;
	 var seriesArray = [];
	 var salesArray = [];
	 var dataArray1 = [];
	 var dataArray2 = [];
	 var stCount = 0;
	 for(var i = 0; i < json.attentionSpecsList.length;i++) {
		 var detail = json.attentionSpecsList[i];
	 	salesArray.push(detail.specs);
	 	dataArray1.push(detail.attention);
	 	dataArray2.push(detail.askPriceNum);
	 	stCount++;
	 }
	 if(stCount > 0) {
	 	var vrw = parseInt($("#viewReport").css("width").substr(0,$("#viewReport").css("width").length-2));
	 	var wt = 120*stCount < vrw ? vrw : 120*stCount;
	 	$("#viewReport").css("width",wt+"px");
	 } else {
	 	$("#viewReport").css("width","100%");
	 }
	 var dataArray = [dataArray1,dataArray2];
	 for(var i = 0; i < titleArray.length;i++) {
	 var tempJson = {
						name: titleArray[i],
						type: json.reportType,
						data: dataArray[i],
						label: {
                			normal: {
                    		show: true,
                    		position: 'inside'
               	 		}
            },
					};
	 	seriesArray.push(tempJson);
	 }
		var getOption = function(chartType) {
				var chartOption =  {
					legend: {
						data: titleArray
					},
					grid: {
						left: '3%',
        				right: '4%',
       					bottom: '3%',
						containLabel: true
					},
					toolbox: {
						show: false,
						feature: {
							mark: {
								show: true
							},
							dataView: {
								show: true,
								readOnly: false
							},
							magicType: {
								show: true,
								type: ['bar','line']
							},
							restore: {
								show: true
							},
							saveAsImage: {
								show: true
							}
						}
					},
					calculable: false,
					xAxis: [{
						type: 'category',
						splitLine: {show:true},
						data: salesArray,
						nameLocation:'end',//坐标轴名称显示位置。
           				axisLabel : {//坐标轴刻度标签的相关设置。
				           formatter : function(params){
                   var newParamsName = "";// 最终拼接成的字符串
                            var paramsNameNumber = params.length;// 实际标签的个数
                            var provideNumber = 8;// 每行能显示的字的个数
                            var rowNumber = Math.ceil(paramsNameNumber / provideNumber);// 换行的话，需要显示几行，向上取整
                            /**
                             * 判断标签的个数是否大于规定的个数， 如果大于，则进行换行处理 如果不大于，即等于或小于，就返回原标签
                             */
                            // 条件等同于rowNumber>1
                            if (paramsNameNumber > provideNumber) {
                                /** 循环每一行,p表示行 */
                                for (var p = 0; p < rowNumber; p++) {
                                    var tempStr = "";// 表示每一次截取的字符串
                                    var start = p * provideNumber;// 开始截取的位置
                                    var end = start + provideNumber;// 结束截取的位置
                                    // 此处特殊处理最后一行的索引值
                                    if (p == rowNumber - 1) {
                                        // 最后一次不换行
                                        tempStr = params.substring(start, paramsNameNumber);
                                    } else {
                                        // 每一次拼接字符串并换行
                                        tempStr = params.substring(start, end) + "\n";
                                    }
                                    newParamsName += tempStr;// 最终拼成的字符串
                                }

                            } else {
                                // 将旧标签的值赋给新标签
                                newParamsName = params;
                            }
                            //将最终的字符串返回
                            return newParamsName
                }
           				}
					}],
					yAxis: [{
						type: 'value',
						splitArea: {
							show: true
						}
					}],
					series: seriesArray
				};
				return chartOption;
			};
			var byId = function(id) {
				return document.getElementById(id);
			};
			var barChart = echarts.init(byId(json.reportId),'light');
			barChart.setOption(getOption(json.reportType));
	}
</script>
</html>
